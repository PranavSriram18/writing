<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 640" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;">
  <!-- Title -->
  <text x="425" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#2c3e50">
    Sliding Window Attention (w=3)
  </text>
  
  <!-- Axis Labels -->
  <text x="425" y="600" text-anchor="middle" font-size="16" fill="#34495e" font-weight="600">
    Time (Tokens) →
  </text>
  
  <text x="15" y="320" text-anchor="middle" font-size="16" fill="#34495e" font-weight="600" transform="rotate(-90, 15, 320)">
    Depth (Layers) →
  </text>
  
  <!-- Arrow markers for different streams -->
  <defs>
    <marker id="arrow-stream5" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3498db" />
    </marker>
    <marker id="arrow-stream4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60" />
    </marker>
  </defs>
  
  <!-- Grid nodes -->
  <!-- Layer 0 (tokens) -->
  <g id="layer-0">
    <circle cx="100" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="200" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="300" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="400" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="500" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="600" cy="500" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    
    <text x="80" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₁,₀</text>
    <text x="180" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₂,₀</text>
    <text x="280" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₃,₀</text>
    <text x="380" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₄,₀</text>
    <text x="480" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₅,₀</text>
    <text x="580" y="505" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₆,₀</text>
  </g>
  
  <!-- Layer 1 (now visible for context) -->
  <g id="layer-1">
    <circle cx="100" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="200" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="300" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="400" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="500" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="600" cy="400" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    
    <text x="80" y="405" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₁,₁</text>
    <text x="180" y="405" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₂,₁</text>
    <text x="280" y="405" text-anchor="end" font-size="14" fill="#2c3e50" font-style="italic" font-weight="600">x₃,₁</text>
    <text x="380" y="405" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₄,₁</text>
    <text x="480" y="405" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₅,₁</text>
    <text x="580" y="405" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₆,₁</text>
  </g>
  
  <!-- Layer 2 (main focus) -->
  <g id="layer-3">
    <circle cx="100" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="200" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="300" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="400" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="500" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    <circle cx="600" cy="280" r="8" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2"/>
    
    <text x="80" y="285" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₁,₂</text>
    <text x="180" y="285" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₂,₂</text>
    <text x="280" y="285" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₃,₂</text>
    <text x="380" y="285" text-anchor="end" font-size="14" fill="#2c3e50" font-style="italic" font-weight="600">x₄,₂</text>
    <text x="480" y="285" text-anchor="end" font-size="14" fill="#2c3e50" font-style="italic" font-weight="600">x₅,₂</text>
    <text x="580" y="285" text-anchor="end" font-size="14" fill="#7f8c8d" font-style="italic">x₆,₂</text>
  </g>
  
  <!-- Layer 3 (lighter, for context) -->
  <g id="layer-4" opacity="0.3">
    <circle cx="100" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
    <circle cx="200" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
    <circle cx="300" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
    <circle cx="400" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
    <circle cx="500" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
    <circle cx="600" cy="160" r="7" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1.5"/>
  </g>
  
  <!-- Attention edges for stream 4 (green) -->
  <!-- (2,2) → (4,2) - curved -->
  <path d="M 208 280 Q 300 260 392 280" stroke="#27ae60" stroke-width="3.5" fill="none" marker-end="url(#arrow-stream4)" opacity="0.85"/>
  <!-- (3,2) → (4,2) - straight -->
  <line x1="308" y1="280" x2="392" y2="280" stroke="#27ae60" stroke-width="3.5" marker-end="url(#arrow-stream4)" opacity="0.85"/>
  
  <!-- Attention edges for stream 5 (blue) -->
  <!-- (3,2) → (5,2) - curved -->
  <path d="M 308 280 Q 400 260 492 280" stroke="#3498db" stroke-width="3.5" fill="none" marker-end="url(#arrow-stream5)" opacity="0.85"/>
  <!-- (4,2) → (5,2) - straight -->
  <line x1="408" y1="280" x2="492" y2="280" stroke="#3498db" stroke-width="3.5" marker-end="url(#arrow-stream5)" opacity="0.85"/>
  
  <!-- Vertical residual edge from (3,1) to (3,2) -->
  <defs>
    <marker id="arrow-residual" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#9b59b6" />
    </marker>
    <marker id="arrow-stream3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
    </marker>
  </defs>
  <line x1="300" y1="392" x2="300" y2="288" stroke="#9b59b6" stroke-width="3" marker-end="url(#arrow-residual)" opacity="0.7"/>
  
  <!-- Attention edges for stream 3 at layer 1 (red) -->
  <!-- (1,1) → (3,1) - curved -->
  <path d="M 108 400 Q 200 380 292 400" stroke="#e74c3c" stroke-width="3.5" fill="none" marker-end="url(#arrow-stream3)" opacity="0.85"/>
  <!-- (2,1) → (3,1) - straight -->
  <line x1="208" y1="400" x2="292" y2="400" stroke="#e74c3c" stroke-width="3.5" marker-end="url(#arrow-stream3)" opacity="0.85"/>
  
  <!-- Highlight target nodes -->
  <circle cx="300" cy="400" r="11" fill="none" stroke="#e74c3c" stroke-width="2.5"/>
  <circle cx="400" cy="280" r="11" fill="none" stroke="#27ae60" stroke-width="2.5"/>
  <circle cx="500" cy="280" r="11" fill="none" stroke="#3498db" stroke-width="2.5"/>
  
  <!-- Window annotations -->
  <!-- Window for stream 3 at layer 1 -->
  <path d="M 100 365 L 300 365 L 300 435 L 100 435 Z" stroke="#e74c3c" stroke-width="2" fill="none" stroke-dasharray="5,5" opacity="0.4"/>
  <text x="200" y="355" text-anchor="middle" font-size="12" fill="#e74c3c" font-weight="600">Window (w=3)</text>
  
  <!-- Window for stream 4 -->
  <path d="M 200 240 L 400 240 L 400 320 L 200 320 Z" stroke="#27ae60" stroke-width="2" fill="none" stroke-dasharray="5,5" opacity="0.4"/>
  <text x="300" y="230" text-anchor="middle" font-size="12" fill="#27ae60" font-weight="600">Window (w=3)</text>
  
  <!-- Window for stream 5 -->
  <path d="M 300 205 L 500 205 L 500 320 L 300 320 Z" stroke="#3498db" stroke-width="2" fill="none" stroke-dasharray="5,5" opacity="0.4"/>
  <text x="400" y="195" text-anchor="middle" font-size="12" fill="#3498db" font-weight="600">Window (w=3)</text>
  
  <!-- Legend -->
  <g id="legend" transform="translate(630, 180)">
    <rect x="0" y="0" width="210" height="175" fill="white" stroke="#bdc3c7" stroke-width="1" rx="5"/>
    
    <text x="105" y="25" text-anchor="middle" font-size="14" font-weight="600" fill="#2c3e50">Attention Edges</text>
    
    <!-- Stream 3 at layer 1 -->
    <line x1="15" y1="45" x2="45" y2="45" stroke="#e74c3c" stroke-width="3.5"/>
    <text x="55" y="49" font-size="12" fill="#34495e" font-weight="600">Stream 3 (l=1)</text>
    <text x="55" y="63" font-size="10" fill="#7f8c8d" font-style="italic">attends to 1,2,3</text>
    
    <!-- Stream 5 -->
    <line x1="15" y1="85" x2="45" y2="85" stroke="#3498db" stroke-width="3.5"/>
    <text x="55" y="89" font-size="12" fill="#34495e" font-weight="600">Stream 5 (l=2)</text>
    <text x="55" y="103" font-size="10" fill="#7f8c8d" font-style="italic">attends to 3,4,5</text>
    
    <!-- Stream 4 -->
    <line x1="15" y1="125" x2="45" y2="125" stroke="#27ae60" stroke-width="3.5"/>
    <text x="55" y="129" font-size="12" fill="#34495e" font-weight="600">Stream 4 (l=2)</text>
    <text x="55" y="143" font-size="10" fill="#7f8c8d" font-style="italic">attends to 2,3,4</text>
    
    <!-- Residual edge -->
    <line x1="15" y1="165" x2="15" y2="155" stroke="#9b59b6" stroke-width="3"/>
    <polygon points="12 155, 15 148, 18 155" fill="#9b59b6"/>
    <text x="30" y="163" font-size="11" fill="#34495e" font-weight="600">Residual (3,1)→(3,2)</text>
  </g>
  
  <!-- Explanation box -->
  <g id="explanation" transform="translate(630, 375)">
    <rect x="0" y="0" width="210" height="85" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="5"/>
    
    <text x="105" y="20" text-anchor="middle" font-size="11" fill="#2c3e50" font-weight="600">N(t, l) = {max(1, t-2),</text>
    <text x="105" y="35" text-anchor="middle" font-size="11" fill="#2c3e50" font-weight="600">..., t-1, t}</text>
    <text x="105" y="55" text-anchor="middle" font-size="10" fill="#34495e">Each stream attends</text>
    <text x="105" y="68" text-anchor="middle" font-size="10" fill="#34495e">to w=3 most recent</text>
    <text x="105" y="81" text-anchor="middle" font-size="10" fill="#34495e">neighbors (including self)</text>
  </g>
  
  <!-- Token labels at bottom -->
  <text x="100" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₁</text>
  <text x="200" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₂</text>
  <text x="300" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₃</text>
  <text x="400" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₄</text>
  <text x="500" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₅</text>
  <text x="600" y="540" text-anchor="middle" font-size="13" fill="#34495e">w₆</text>
  
  <!-- Layer labels on left -->
  <text x="35" y="505" text-anchor="middle" font-size="13" fill="#7f8c8d" font-weight="600">l=0</text>
  <text x="35" y="405" text-anchor="middle" font-size="13" fill="#34495e" font-weight="600">l=1</text>
  <text x="35" y="285" text-anchor="middle" font-size="13" fill="#34495e" font-weight="600">l=2</text>
  <text x="35" y="165" text-anchor="middle" font-size="13" fill="#7f8c8d" font-weight="600">l=3</text>
</svg>